# object-monitor.object-info.status <status>
#   Contains information about the status of the object (visible/in-view/etc)

# Elaborate the status identifier
sp {top-state*perception-monitor*object-monitor*object-info*elaborate*status
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.{ << object-info new-object-info >> } <obj-info>)
-->
   (<obj-info> ^status <status>)
}

##################################################################
#
# is-in-svs1 << in-svs1 not-in-svs1 >>
#   whether the object has a belief object in svs
#
##################################################################

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*in-svs1
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^belief-obj <bel-obj>
               ^status <status>)
-->
   (<status> ^is-in-svs1 in-svs1)
}

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*not-in-svs1
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^status <status>)
   (<status> -^is-in-svs1 in-svs1)
-->
   (<status> ^is-in-svs1 not-in-svs1)
}

##################################################################
#
# in-view << true false >>
#   true if the belief object is in the robot's view volume (should be visible)
#
#################################################################

# Fully Observable Environments, objects are always in view
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*in-view*true*tabletop
   (state <s> ^superstate nil
              ^agent-params.domain << tabletop fetch >>
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^status <status>)
-->
   (<status> ^in-view true)
}

# Fully Observable Within Room - only the current room is fully visible (essentially just test if on input-link)
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*in-view*true
   (state <s> ^superstate nil
              ^agent-params.domain << internal ai2thor >>
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^input-link-obj <il-obj>
               ^status <status>)
-->
   (<status> ^in-view true)
}

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*in-view*false
   (state <s> ^superstate nil
              ^agent-params.domain << internal ai2thor >>
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> -^input-link-obj <il-obj>
               ^status <status>)
-->
   (<status> ^in-view false)
}

# Partially Observable Domains, objects are in view if they intersect the view volume
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*in-view*from*filter
   (state <s> ^superstate nil
              ^agent-params.domain << magicbot cozmo >>
              ^perception-monitor.object-monitor.object-info <obj-info>
              ^perception-monitor.robot-view-filter.result.record <r>)
   (<obj-info> ^belief-obj.id <bel-id>
               ^status <status>)
   (<r> ^params.b <bel-id>
        ^value { <value> << true false >> })
-->
   (<status> ^in-view <value>)
}



##################################################################
#
# is-visible1 << visible1 not-visible1 >>
#   true if there is an input-link-obj for the object
#
##################################################################

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*visible1
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^input-link-obj <il-obj>
               ^status <status>)
-->
   (<status> ^is-visible1 visible1)
}

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*visible1*current-location
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>
              ^world.robot.current-location <loc>)
   (<obj-info> ^wm-obj <loc>
               ^status <status>)
-->
   (<status> ^is-visible1 visible1)
}

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*not-visible1
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^status <status>)
   (<status> -^is-visible1 visible1)
-->
   (<status> ^is-visible1 not-visible1)
}

##################################################################
#
# distance <num>
#   How far away the object is
#
##################################################################

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*distance
   (state <s> ^superstate nil
              ^agent-params.domain magicbot
              ^perception-monitor <perc-mon>)
   (<perc-mon> ^obj-distance-filter.result.record <rec>
               ^object-monitor.object-info <obj-info>)
   (<obj-info> ^perception-id <perc-id>
               ^status <status>)
   (<rec> ^params.b <perc-id>
          ^value <dist>)
-->
   (<status> ^distance <dist>)
}

##################################################################
#
# is-reachable1 << reachable1 not-reachable1 >>
#   whether the object is in reach of the arm (can pick-up)
#
##################################################################

# For some domains, if an object is visible it is reachable
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*reachable1*if*visible
   (state <s> ^superstate nil
              ^agent-params.domain << fetch tabletop cozmo >>
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^input-link-obj <il-obj>
               ^wm-obj.predicates.category << object person >>
               ^status <status>)
   (<status> ^is-visible1 visible1)
-->
   (<status> ^is-reachable1 reachable1)
}

# For some domains, we get the reachable info from the input-link
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*reachable1*ai2thor
   (state <s> ^superstate nil
              ^agent-params.domain << internal ai2thor >>
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^input-link-obj.property <prop>
               ^status <status>)
   (<prop> ^property-handle is-reachable1
           ^predicate-handle <is-reachable>)
-->
   (<status> ^is-reachable1 <is-reachable>)
}

# For some domains, it is reachable if within a certain distance
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*reachable1*if*within*distance
   (state <s> ^superstate nil
              ^agent-params.domain magicbot
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^input-link-obj <il-obj>
               ^wm-obj.predicates.category << object person >>
               ^status <status>)
   (<status> ^distance < 1.5)
-->
   (<status> ^is-reachable1 reachable1)
}

# Default: not-reachable
sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*not-reachable1
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>)
   (<obj-info> ^status <status>
               ^wm-obj.predicates.category << object person >>)
   (<status> -^is-reachable1 reachable1)
-->
   (<status> ^is-reachable1 not-reachable1)
}

##################################################################
#
# Monitoring occluded objects
#   is-occluded << true false >> - based on the last time occlusion was checked
#   occlusion-timeout <secs> - says the object is occluded until the given time
#
##################################################################

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*is-occluded*true
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info <obj-info>
              ^io.input-link.time.seconds <t>)
   (<obj-info> ^status <status>
               ^occlusion-timeout > <t>)
-->
   (<status> ^is-occluded true)
}

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*is-occluded*false
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor.object-info.status <status>)
   (<status> -^is-occluded true)
-->
   (<status> ^is-occluded false)
}

##################################################################
#
# shared-input-link-obj true
#   true if the object shares a perception-obj with another object
#
#################################################################

sp {top-state*perception-monitor*object-monitor*object-info*status*elaborate*shared-input-link-obj*true
   (state <s> ^superstate nil
              ^perception-monitor.object-monitor <obj-mon>)
   (<obj-mon> ^object-info <obj-info>
              ^object-info { <other-info> <> <obj-info> })
   (<obj-info> ^perception-obj <perc-obj>
               ^status <status>)
   (<other-info> ^perception-obj <perc-obj>)
-->
   (<status> ^shared-input-link-obj true)
}

