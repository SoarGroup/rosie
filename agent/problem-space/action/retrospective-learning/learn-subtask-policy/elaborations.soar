sp {learn-subtask-policy*elaborate*subtask-episode*superoperator
   (state <s> ^name learn-subtask-policy
              ^superstate.operator.subtask-episode <ep>)
-->
   (<s> ^subtask-episode <ep>)
}

sp {learn-subtask-policy*elaborate*goal-handle-subs*from*superstate
   (state <s> ^name learn-subtask-policy
              ^superstate.goal-handle-subs <subs>)
-->
   (<s> ^goal-handle-subs <subs>)
}

#### RECREATE THE STATE #####

# deep-copy the world from the subtask-episode to the state
sp {learn-subtask-policy*elaborate*deep-copy-world*subtask-episode
   (state <s> ^name learn-subtask-policy
              ^subtask-episode.world <w>)
-->
   (<s> ^problem-space <ps>)
   (<ps> ^name action
         ^world <ps-world>)
   (<ps-world> ^source <w>
               ^copy-type deep)
}

# deep-copy the parent task operator with respect to the copied world
sp {learn-subtask-policy*copy-task-operator*task-operator
   (state <s> ^name learn-subtask-policy
              ^subtask-episode.task-stack.bottom.prev.task-operator <task-op>
              ^deep-copy-world.copy-objects-map <map>)
-->
   (<s> ^copy-task-operator <cto>)
   (<cto> ^task-operator <task-op>
          ^destination <s>
          ^copy-name task-operator
          ^object-map <map>)
}

# deep-copy the subtask we want to learn with respect to the copied world
sp {learn-subtask-policy*copy-task-operator*subtask-operator
   (state <s> ^name learn-subtask-policy
              ^subtask-episode.task-stack.bottom.task-operator <subtask-op>
              ^deep-copy-world.copy-objects-map <map>)
-->
   (<s> ^copy-task-operator <cto>)
   (<cto> ^task-operator <subtask-op>
          ^destination <s>
          ^copy-name subtask-operator
          ^object-map <map>)
}

