
sp {retrospective-learning*elaborate*task-handle*superoperator
   (state <s> ^name retrospective-learning
              ^superstate.operator.task-handle <h>)
-->
   (<s> ^task-handle <h>)
}

###############################################################
## subtasks-stack
## Contains a stack of the subtasks performed during the task
## Including the episodes where each was initiated
###############################################################
#
#sp {retrospective-learning*elaborate*subtasks-stack
#   (state <s> ^name retrospective-learning)
#-->
#   (<s> ^subtasks-stack <subs>)
#   (<subs> ^next none
#           ^segments <segs>)
#}
#
## The subtasks structure used to copy subtasks into substates
## (Contains only the actions)
#sp {retrospective-learning*elaborate*subtasks*top
#   (state <s> ^name retrospective-learning
#              ^subtasks-stack.next.subtask-copy <sub>)
#-->
#   (<s> ^subtasks <subs>)
#   (<subs> ^next <sub>)
#}
#
## Elaborate next pointers
#sp {retrospective-learning*elaborate*subtasks*next*none
#   (state <s> ^name retrospective-learning
#              ^subtasks-stack.segments.segment <seg>)
#   (<seg> ^subtask-copy <sub>
#          ^next none)
#-->
#   (<sub> ^next none)
#}
#
#sp {retrospective-learning*elaborate*subtasks*next*sub
#   (state <s> ^name retrospective-learning
#              ^subtasks-stack.segments.segment <seg>)
#   (<seg> ^subtask-copy <sub>
#          ^next.subtask-copy <next>)
#-->
#   (<sub> ^next <next>)
#}
#
## Elaborate the set of segments
#sp {retrospective-learning*elaborate*subtasks-stack*segment
#   (state <s> ^name retrospective-learning
#              ^subtasks-stack <subs>)
#   (<subs> ^next { <seg> <> none }
#           ^segments <segs>)
#-->
#   (<segs> ^segment <seg>)
#}
#
#sp {retrospective-learning*elaborate*subtasks-stack*segment*next
#   (state <s> ^name retrospective-learning
#              ^subtasks-stack <subs>)
#   (<subs> ^segments <segs>)
#   (<segs> ^segment.next { <seg> <> none })
#-->
#   (<segs> ^segment <seg>)
#}
#
## replayed-all-subtasks true
##   elaborated when all subtasks have been replayed 
#sp {retrospective-learning*elaborate*replayed-all-subtasks
#   (state <s> ^name retrospective-learning
#              ^subtasks-stack.retrieved-all true)
#-->
#   (<s> ^replayed-all-subtasks true)
#}
